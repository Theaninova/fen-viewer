import{p as pe,a as ne,C as ve}from"./ChessBoard-57b76d56.js";import{S as Z,i as z,s as K,e as E,k as O,c as k,a as I,m as P,d as u,b as _,g as M,J as f,K as q,L as me,n as b,N as he,O as ge,W as se,X as be,r as $,p as S,l as T,o as _e,q as de,t as D,h as A,x as J,y as H,z as Q,C as W,j as F,Y as ae,R as Ee,P as re,Q as le,Z as ke}from"./index-b452b8f2.js";function Ke(a){return a.sort((e,t)=>t.ID-e.ID).map(e=>({...e,state:pe(e.fen)}))}function Ie(a){return Array.from({length:a},()=>Math.random().toString(36)[2]).join("")}var B=(a=>(a[a.LOGIN=0]="LOGIN",a[a.GET_GAMES=1]="GET_GAMES",a[a.CREATE_GAME=2]="CREATE_GAME",a[a.JOIN_GAME=3]="JOIN_GAME",a[a.MOVE=4]="MOVE",a[a.DATABASE=5]="DATABASE",a[a.START_TOURNAMENT=6]="START_TOURNAMENT",a[a.ERROR=-1]="ERROR",a[a.ILLEGAL_MOVE=-2]="ILLEGAL_MOVE",a[a.NOT_IMPLEMENTED=-3]="NOT_IMPLEMENTED",a[a.INVALID_REQUEST=-4]="INVALID_REQUEST",a[a.UNAUTHORIZED=-5]="UNAUTHORIZED",a[a.FULL=-6]="FULL",a[a.NOT_FOUND=-7]="NOT_FOUND",a))(B||{});async function Ne(a){return new Promise(e=>setTimeout(e,a))}class Xe{constructor(e,t){this.url=e,this.resolveResponses={},this.websocket=new WebSocket(e),this.isUp=new Promise(n=>{this.websocket.addEventListener("open",()=>n())}),this.websocket.addEventListener("message",n=>{var s,r;try{const l=JSON.parse(n.data);(r=(s=this.resolveResponses)[l.stamp])==null||r.call(s,l)}catch{console.error("Invalid Response",n.data)}}),t&&(this.session=!t.playerName||!t.playerID?this.getState().then(()=>{var n;return this.register({username:(n=t.playerName)!=null?n:Ie(20)})}):Promise.resolve(t),this.session.then(n=>{this.playerName=n.playerName,this.login({username:n.playerName,playerID:n.playerID})}))}async request(e){await this.isUp;const t=performance.now(),n=new Promise(r=>{this.resolveResponses[t]=r});this.websocket.send(JSON.stringify({...e,stamp:t}));const s=await n;return delete this.resolveResponses[t],s.type<0&&console.error(s),s.type!==1&&console.log(e,s),s}async join(e){if(!this.session)throw"Not logged in";return this.request({type:B.JOIN_GAME,username:(await this.session).playerName,playerID:(await this.session).playerID,joinAsPlayer:1,...e})}isSelf(e){return this.playerName===e}async register(e){return this.request({...e,type:B.LOGIN,username:e.username})}async login(e){return this.request({type:B.LOGIN,...e})}async createGame(){if(!this.session)throw"Not logged in";return this.request({type:B.CREATE_GAME,username:(await this.session).playerName,playerID:(await this.session).playerID})}async getState(){return this.request({type:B.GET_GAMES})}updateState(e,t){(async()=>{var s;let n=!0;for(;n;)n=(s=t(await this.getState()))!=null?s:!0,await Ne(e)})()}async makeMove(e){if(!this.session)throw"Not logged in";return this.request({type:B.MOVE,username:(await this.session).playerName,playerID:(await this.session).playerID,...e})}}function ye(a){let e,t,n,s,r,l;return{c(){e=E("form"),t=E("input"),n=O(),s=E("input"),this.h()},l(o){e=k(o,"FORM",{class:!0});var i=I(e);t=k(i,"INPUT",{type:!0,name:!0,placeholder:!0,pattern:!0,autocomplete:!0,minlength:!0,maxlength:!0,class:!0}),n=P(i),s=k(i,"INPUT",{type:!0,class:!0}),i.forEach(u),this.h()},h(){t.disabled=a[0],_(t,"type","text"),_(t,"name","name"),_(t,"placeholder","a1a2q"),_(t,"pattern","[a-h][1-8][a-h][1-8][NnBbQqRr]?"),_(t,"autocomplete","off"),_(t,"minlength","2"),_(t,"maxlength","5"),t.required=!0,_(t,"class","svelte-f5chbr"),s.disabled=a[0],_(s,"type","submit"),s.value="Move",_(s,"class","svelte-f5chbr"),_(e,"class","svelte-f5chbr")},m(o,i){M(o,e,i),f(e,t),a[3](t),f(e,n),f(e,s),r||(l=q(e,"submit",me(a[4])),r=!0)},p(o,[i]){i&1&&(t.disabled=o[0]),i&1&&(s.disabled=o[0])},i:b,o:b,d(o){o&&u(e),a[3](null),r=!1,l()}}}function we(a,e,t){let n=he(),{disabled:s=!1}=e,r;function l(i){ge[i?"unshift":"push"](()=>{r=i,t(1,r)})}const o=()=>n("move",r.value);return a.$$set=i=>{"disabled"in i&&t(0,s=i.disabled)},[s,r,n,l,o]}class Me extends Z{constructor(e){super(),z(this,e,we,ye,K,{disabled:0})}}function Ce(a){let e,t,n,s;return{c(){e=E("form"),t=E("input"),this.h()},l(r){e=k(r,"FORM",{class:!0});var l=I(e);t=k(l,"INPUT",{type:!0,class:!0}),l.forEach(u),this.h()},h(){t.disabled=a[0],_(t,"type","submit"),t.value="Join",_(t,"class","svelte-6c43yd"),_(e,"class","svelte-6c43yd")},m(r,l){M(r,e,l),f(e,t),n||(s=q(e,"submit",me(a[2])),n=!0)},p(r,[l]){l&1&&(t.disabled=r[0])},i:b,o:b,d(r){r&&u(e),n=!1,s()}}}function De(a,e,t){let n=he(),{disabled:s=!1}=e;const r=()=>n("join");return a.$$set=l=>{"disabled"in l&&t(0,s=l.disabled)},[s,n,r]}class Ae extends Z{constructor(e){super(),z(this,e,De,Ce,K,{disabled:0})}}function Ge(a){return{c:b,l:b,m:b,p:b,i:b,o:b,d:b}}function $e(a){let e,t,n,s;const r=[Oe,Se],l=[];function o(i,c){return i[3]?0:1}return e=o(a),t=l[e]=r[e](a),{c(){t.c(),n=T()},l(i){t.l(i),n=T()},m(i,c){l[e].m(i,c),M(i,n,c),s=!0},p(i,c){let d=e;e=o(i),e===d?l[e].p(i,c):(_e(),S(l[d],1,1,()=>{l[d]=null}),de(),t=l[e],t?t.p(i,c):(t=l[e]=r[e](i),t.c()),$(t,1),t.m(n.parentNode,n))},i(i){s||($(t),s=!0)},o(i){S(t),s=!1},d(i){l[e].d(i),i&&u(n)}}}function Se(a){let e,t;return e=new Ae({props:{disabled:a[0]===1&&!a[2]}}),e.$on("join",a[5]),{c(){J(e.$$.fragment)},l(n){H(e.$$.fragment,n)},m(n,s){Q(e,n,s),t=!0},p(n,s){const r={};s&5&&(r.disabled=n[0]===1&&!n[2]),e.$set(r)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){W(e,n)}}}function Oe(a){let e,t,n,s,r;const l=[Le,Pe],o=[];function i(c,d){return d&10&&(e=null),e==null&&(e=!!c[1].isSelf(c[3].playerName)),e?0:1}return t=i(a,-1),n=o[t]=l[t](a),{c(){n.c(),s=T()},l(c){n.l(c),s=T()},m(c,d){o[t].m(c,d),M(c,s,d),r=!0},p(c,d){let p=t;t=i(c,d),t===p?o[t].p(c,d):(_e(),S(o[p],1,1,()=>{o[p]=null}),de(),n=o[t],n?n.p(c,d):(n=o[t]=l[t](c),n.c()),$(n,1),n.m(s.parentNode,s))},i(c){r||($(n),r=!0)},o(c){S(n),r=!1},d(c){o[t].d(c),c&&u(s)}}}function Pe(a){let e=a[3].playerName+"",t;return{c(){t=D(e)},l(n){t=A(n,e)},m(n,s){M(n,t,s)},p(n,s){s&8&&e!==(e=n[3].playerName+"")&&F(t,e)},i:b,o:b,d(n){n&&u(t)}}}function Le(a){let e,t;return e=new Me({}),e.$on("move",a[6]),{c(){J(e.$$.fragment)},l(n){H(e.$$.fragment,n)},m(n,s){Q(e,n,s),t=!0},p:b,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){W(e,n)}}}function Ue(a){let e;return{c(){e=D("loading...")},l(t){e=A(t,"loading...")},m(t,n){M(t,e,n)},p:b,i:b,o:b,d(t){t&&u(e)}}}function je(a){let e,t,n,s={ctx:a,current:null,token:null,hasCatch:!1,pending:Ue,then:$e,catch:Ge,value:4,blocks:[,,,]};return se(t=a[4],s),{c(){e=E("div"),s.block.c(),this.h()},l(r){e=k(r,"DIV",{class:!0});var l=I(e);s.block.l(l),l.forEach(u),this.h()},h(){_(e,"class","svelte-cjlmea")},m(r,l){M(r,e,l),s.block.m(e,s.anchor=null),s.mount=()=>e,s.anchor=null,n=!0},p(r,[l]){a=r,s.ctx=a,l&16&&t!==(t=a[4])&&se(t,s)||be(s,a,l)},i(r){n||($(s.block),n=!0)},o(r){for(let l=0;l<3;l+=1){const o=s.blocks[l];S(o)}n=!1},d(r){r&&u(e),s.block.d(),s.token=null,s=null}}}function Ve(a,e,t){let n,s,{index:r}=e,{game:l}=e,{serverConnection:o}=e,i=Promise.resolve(!1);function c(){t(4,i=o.join({gameID:l.ID}).then(()=>!0))}function d(p){o.makeMove({gameID:l.ID,move:p.detail})}return a.$$set=p=>{"index"in p&&t(0,r=p.index),"game"in p&&t(7,l=p.game),"serverConnection"in p&&t(1,o=p.serverConnection)},a.$$.update=()=>{a.$$.dirty&129&&t(3,n=l.activePlayerList[r]),a.$$.dirty&128&&t(2,s=l.activePlayerList[0]),a.$$.dirty&129&&l.activePlayerList[Number(!r)]},[r,o,s,n,i,c,d,l]}class ie extends Z{constructor(e){super(),z(this,e,Ve,je,K,{index:0,game:7,serverConnection:1})}}function oe(a,e,t){const n=a.slice();return n[2]=e[t],n}function ce(a){let e,t=a[0].castling,n=[];for(let s=0;s<t.length;s+=1)n[s]=fe(oe(a,t,s));return{c(){for(let s=0;s<n.length;s+=1)n[s].c();e=T()},l(s){for(let r=0;r<n.length;r+=1)n[r].l(s);e=T()},m(s,r){for(let l=0;l<n.length;l+=1)n[l].m(s,r);M(s,e,r)},p(s,r){if(r&1){t=s[0].castling;let l;for(l=0;l<t.length;l+=1){const o=oe(s,t,l);n[l]?n[l].p(o,r):(n[l]=fe(o),n[l].c(),n[l].m(e.parentNode,e))}for(;l<n.length;l+=1)n[l].d(1);n.length=t.length}},d(s){Ee(n,s),s&&u(e)}}}function fe(a){let e,t=ne[a[2]]+"",n,s;return{c(){e=E("span"),n=D(t),this.h()},l(r){e=k(r,"SPAN",{class:!0});var l=I(e);n=A(l,t),l.forEach(u),this.h()},h(){_(e,"class",s=ae(a[2].toUpperCase()===a[2]?"white":"black")+" svelte-1xuo7t7")},m(r,l){M(r,e,l),f(e,n)},p(r,l){l&1&&t!==(t=ne[r[2]]+"")&&F(n,t),l&1&&s!==(s=ae(r[2].toUpperCase()===r[2]?"white":"black")+" svelte-1xuo7t7")&&_(e,"class",s)},d(r){r&&u(e)}}}function ue(a){let e,t=a[0].enPassant.toUpperCase()+"",n;return{c(){e=E("p"),n=D(t)},l(s){e=k(s,"P",{});var r=I(e);n=A(r,t),r.forEach(u)},m(s,r){M(s,e,r),f(e,n)},p(s,r){r&1&&t!==(t=s[0].enPassant.toUpperCase()+"")&&F(n,t)},d(s){s&&u(e)}}}function Be(a){let e,t,n,s=a[0].turn==="w"?"White":"Black",r,l,o,i,c,d,p=a[0].fullMoves+"",j,L,C,V,w,G=a[0].halfMoves+"",m,v,U,h=a[0].castling&&ce(a),g=a[0].enPassant&&ue(a);return{c(){e=E("div"),t=E("p"),n=D("\u2B6E "),r=D(s),l=O(),o=E("p"),h&&h.c(),i=O(),g&&g.c(),c=O(),d=E("p"),j=D(p),L=E("sub"),C=D("F"),V=O(),w=E("p"),m=D(G),v=E("sub"),U=D("H"),this.h()},l(N){e=k(N,"DIV",{class:!0});var y=I(e);t=k(y,"P",{});var X=I(t);n=A(X,"\u2B6E "),r=A(X,s),X.forEach(u),l=P(y),o=k(y,"P",{class:!0});var x=I(o);h&&h.l(x),x.forEach(u),i=P(y),g&&g.l(y),c=P(y),d=k(y,"P",{});var Y=I(d);j=A(Y,p),L=k(Y,"SUB",{});var ee=I(L);C=A(ee,"F"),ee.forEach(u),Y.forEach(u),V=P(y),w=k(y,"P",{});var R=I(w);m=A(R,G),v=k(R,"SUB",{});var te=I(v);U=A(te,"H"),te.forEach(u),R.forEach(u),y.forEach(u),this.h()},h(){_(o,"class","castling"),_(e,"class","svelte-1xuo7t7")},m(N,y){M(N,e,y),f(e,t),f(t,n),f(t,r),f(e,l),f(e,o),h&&h.m(o,null),f(e,i),g&&g.m(e,null),f(e,c),f(e,d),f(d,j),f(d,L),f(L,C),f(e,V),f(e,w),f(w,m),f(w,v),f(v,U)},p(N,[y]){y&1&&s!==(s=N[0].turn==="w"?"White":"Black")&&F(r,s),N[0].castling?h?h.p(N,y):(h=ce(N),h.c(),h.m(o,null)):h&&(h.d(1),h=null),N[0].enPassant?g?g.p(N,y):(g=ue(N),g.c(),g.m(e,c)):g&&(g.d(1),g=null),y&1&&p!==(p=N[0].fullMoves+"")&&F(j,p),y&1&&G!==(G=N[0].halfMoves+"")&&F(m,G)},i:b,o:b,d(N){N&&u(e),h&&h.d(),g&&g.d()}}}function Fe(a,e,t){let n,{game:s}=e;return a.$$set=r=>{"game"in r&&t(1,s=r.game)},a.$$.update=()=>{a.$$.dirty&2&&t(0,n=s.state)},[n,s]}class Je extends Z{constructor(e){super(),z(this,e,Fe,Be,K,{game:1})}}function He(a){let e,t,n=a[0].ID+"",s,r,l,o,i,c,d,p,j,L,C,V,w,G;return l=new Je({props:{game:a[0]}}),c=new ie({props:{index:0,game:a[0],serverConnection:a[1]}}),C=new ie({props:{index:1,game:a[0],serverConnection:a[1]}}),w=new ve({props:{chessState:a[0].state}}),{c(){e=E("div"),t=E("h2"),s=D(n),r=O(),J(l.$$.fragment),o=O(),i=E("div"),J(c.$$.fragment),d=O(),p=E("em"),j=D("vs"),L=O(),J(C.$$.fragment),V=O(),J(w.$$.fragment),this.h()},l(m){e=k(m,"DIV",{class:!0});var v=I(e);t=k(v,"H2",{});var U=I(t);s=A(U,n),U.forEach(u),r=P(v),H(l.$$.fragment,v),o=P(v),i=k(v,"DIV",{class:!0});var h=I(i);H(c.$$.fragment,h),d=P(h),p=k(h,"EM",{});var g=I(p);j=A(g,"vs"),g.forEach(u),L=P(h),H(C.$$.fragment,h),h.forEach(u),V=P(v),H(w.$$.fragment,v),v.forEach(u),this.h()},h(){_(i,"class","vs-note svelte-eexnjb"),_(e,"class","game svelte-eexnjb")},m(m,v){M(m,e,v),f(e,t),f(t,s),f(e,r),Q(l,e,null),f(e,o),f(e,i),Q(c,i,null),f(i,d),f(i,p),f(p,j),f(i,L),Q(C,i,null),f(e,V),Q(w,e,null),G=!0},p(m,[v]){(!G||v&1)&&n!==(n=m[0].ID+"")&&F(s,n);const U={};v&1&&(U.game=m[0]),l.$set(U);const h={};v&1&&(h.game=m[0]),v&2&&(h.serverConnection=m[1]),c.$set(h);const g={};v&1&&(g.game=m[0]),v&2&&(g.serverConnection=m[1]),C.$set(g);const N={};v&1&&(N.chessState=m[0].state),w.$set(N)},i(m){G||($(l.$$.fragment,m),$(c.$$.fragment,m),$(C.$$.fragment,m),$(w.$$.fragment,m),G=!0)},o(m){S(l.$$.fragment,m),S(c.$$.fragment,m),S(C.$$.fragment,m),S(w.$$.fragment,m),G=!1},d(m){m&&u(e),W(l),W(c),W(C),W(w)}}}function Qe(a,e,t){let{game:n}=e,{serverConnection:s}=e;return a.$$set=r=>{"game"in r&&t(0,n=r.game),"serverConnection"in r&&t(1,s=r.serverConnection)},[n,s]}class Ye extends Z{constructor(e){super(),z(this,e,Qe,He,K,{game:0,serverConnection:1})}}function We(a){let e,t,n,s,r;return{c(){e=E("div"),t=re("svg"),n=re("path"),this.h()},l(l){e=k(l,"DIV",{class:!0});var o=I(e);t=le(o,"svg",{viewBox:!0,xmlns:!0,class:!0});var i=I(t);n=le(i,"path",{fill:!0,d:!0}),I(n).forEach(u),i.forEach(u),o.forEach(u),this.h()},h(){_(n,"fill","currentColor"),_(n,"d","M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"),_(t,"viewBox","0 0 24 24"),_(t,"xmlns","http://www.w3.org/2000/svg"),_(t,"class","svelte-1i1fcd2"),_(e,"class","svelte-1i1fcd2")},m(l,o){M(l,e,o),f(e,t),f(t,n),s||(r=q(t,"click",function(){ke(a[0].createGame())&&a[0].createGame().apply(this,arguments)}),s=!0)},p(l,[o]){a=l},i:b,o:b,d(l){l&&u(e),s=!1,r()}}}function Te(a,e,t){let{serverConnection:n}=e;return a.$$set=s=>{"serverConnection"in s&&t(0,n=s.serverConnection)},[n]}class Re extends Z{constructor(e){super(),z(this,e,Te,We,K,{serverConnection:0})}}export{Re as C,Ye as G,Xe as S,Ke as p};
